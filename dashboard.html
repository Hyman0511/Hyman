<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WuShi Admin - Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .dashboard-container {
            padding: 20px;
        }

        .dashboard-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .dashboard-header p {
            margin-bottom: 0;
        }

        .dashboard-header-actions {
            display: flex;
            gap: 10px;
        }

        .export-csv-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-csv-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .export-csv-btn:active {
            transform: translateY(0);
        }

        .export-csv-btn .icon {
            font-size: 1.2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .dashboard-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .dashboard-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .action-card {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .action-card:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .action-card .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .action-card h3 {
            color: var(--text-color);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .action-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .recent-orders {
            max-height: 400px;
            overflow-y: auto;
        }

        .order-item {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-info h4 {
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .order-info p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .order-status.completed {
            background-color: #4CAF50;
            color: white;
        }

        .order-status.pending {
            background-color: #FFA500;
            color: white;
        }

        .order-status.cancelled {
            background-color: #e74c3c;
            color: white;
        }

        .low-stock-products {
            max-height: 400px;
            overflow-y: auto;
        }

        .product-item {
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-info h4 {
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .product-info p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .stock-level {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .stock-level.low {
            background-color: #e74c3c;
            color: white;
        }

        .stock-level.medium {
            background-color: #FFA500;
            color: white;
        }

        .stock-level.good {
            background-color: #4CAF50;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary-color);
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-body {
            color: var(--text-color);
        }

        .modal-body p {
            margin-bottom: 15px;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #666;
        }

        .dark-mode .stat-card {
            background-color: #2a2a2a;
        }

        .dark-mode .dashboard-section {
            background-color: #2a2a2a;
        }

        .dark-mode .action-card {
            background-color: #1a1a1a;
        }

        .dark-mode .order-item {
            background-color: #1a1a1a;
        }

        .dark-mode .product-item {
            background-color: #1a1a1a;
        }

        .dark-mode .modal-content {
            background-color: #2a2a2a;
        }


        .register-title {
            margin: 0;
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: normal;
        }
    </style>
</head>
<body>
    <div class="overlay">
        <button class="logout-button" id="logout-btn">Logout</button>
        <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light mode">
        </button>
        
        <div class="container">
            <header>
                <div class="logo">
                    <a href="index.html">
                        <img src="images/lunch-restaurant-logo.png" alt="Lunch Restaurant Logo" class="logo-image">
                        <h1 class="logo-text">WuShi Snacks</h1>
                    </a>
                </div>
                <nav>
                    <div class="nav-links">
                        <a href="index.html">Home</a>
                        <a href="products.html">Products</a>
                        <a href="about.html">About Us</a>
                        <a href="login.html">Login</a>
                        <a href="https://hyman.rf.gd/">Register</a>
                        <a href="admin.html">Admin</a>
                        <a href="cart.html">Cart</a>
                        <a href="forum.html">Forum</a>
                        <a href="contact.html">Contact Us</a>
                        <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light mode">
                        </button>
                    </div>
                </nav>
            </header>

            <div class="dashboard-container">
                <div class="dashboard-header">
                    <div>
                        <h1>Admin Dashboard</h1>
                        <p>Overview of your store performance and management</p>
                    </div>
                    <div class="dashboard-header-actions">
                        <button class="export-csv-btn" id="export-csv-btn">
                            <span class="icon">üìä</span>
                            Export CSV
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="stat-value" id="total-products">0</div>
                        <div class="stat-label">Active products in store</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="stat-value" id="total-orders">0</div>
                        <div class="stat-label">Orders this month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="stat-value" id="total-revenue">$0</div>
                        <div class="stat-label">Revenue this month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Low Stock Items</h3>
                        <div class="stat-value" id="low-stock">0</div>
                        <div class="stat-label">Items need restocking</div>
                    </div>
                </div>

                <div class="dashboard-sections">
                    <div class="dashboard-section">
                        <h2>Quick Actions</h2>
                        <div class="quick-actions">
                            <div class="action-card" id="add-product-action">
                                <div class="icon">üì¶</div>
                                <h3>Add Product</h3>
                                <p>Add new products to inventory</p>
                            </div>
                            <div class="action-card" id="manage-orders-action">
                                <div class="icon">üìã</div>
                                <h3>Manage Orders</h3>
                                <p>View and process orders</p>
                            </div>
                            <div class="action-card" id="view-customers-action">
                                <div class="icon">üë•</div>
                                <h3>View Customers</h3>
                                <p>Manage customer accounts</p>
                            </div>
                            <div class="action-card" id="reports-action">
                                <div class="icon">üìä</div>
                                <h3>View Reports</h3>
                                <p>Analytics and insights</p>
                            </div>
                            <div class="action-card" id="settings-action">
                                <div class="icon">‚öôÔ∏è</div>
                                <h3>Settings</h3>
                                <p>Configure store settings</p>
                            </div>
                            <div class="action-card" id="notifications-action">
                                <div class="icon">üîî</div>
                                <h3>Notifications</h3>
                                <p>View system alerts</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h2>Recent Orders</h2>
                        <div class="recent-orders" id="recent-orders">
                            <div class="order-item">
                                <div class="order-info">
                                    <h4>Order #1234</h4>
                                    <p>Customer: John Doe - 3 items</p>
                                </div>
                                <div class="order-status completed">Completed</div>
                            </div>
                            <div class="order-item">
                                <div class="order-info">
                                    <h4>Order #1235</h4>
                                    <p>Customer: Jane Smith - 5 items</p>
                                </div>
                                <div class="order-status pending">Pending</div>
                            </div>
                            <div class="order-item">
                                <div class="order-info">
                                    <h4>Order #1236</h4>
                                    <p>Customer: Bob Johnson - 2 items</p>
                                </div>
                                <div class="order-status completed">Completed</div>
                            </div>
                            <div class="order-item">
                                <div class="order-info">
                                    <h4>Order #1237</h4>
                                    <p>Customer: Alice Brown - 4 items</p>
                                </div>
                                <div class="order-status cancelled">Cancelled</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h2>Low Stock Products</h2>
                        <div class="low-stock-products" id="low-stock-products">
                            <div class="product-item">
                                <div class="product-info">
                                    <h4>Spicy Snack Mix</h4>
                                    <p>Category: Snacks</p>
                                </div>
                                <div class="stock-level low">5 left</div>
                            </div>
                            <div class="product-item">
                                <div class="product-info">
                                    <h4>Hot Sauce Special</h4>
                                    <p>Category: Sauces</p>
                                </div>
                                <div class="stock-level medium">12 left</div>
                            </div>
                            <div class="product-item">
                                <div class="product-info">
                                    <h4>Crispy Chips</h4>
                                    <p>Category: Snacks</p>
                                </div>
                                <div class="stock-level low">3 left</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h2>System Status</h2>
                        <div class="order-item">
                            <div class="order-info">
                                <h4>Server Status</h4>
                                <p>System is running normally</p>
                            </div>
                            <div class="order-status completed">Online</div>
                        </div>
                        <div class="order-item">
                            <div class="order-info">
                                <h4>Database</h4>
                                <p>Last backup: 2 hours ago</p>
                            </div>
                            <div class="order-status completed">Connected</div>
                        </div>
                        <div class="order-item">
                            <div class="order-info">
                                <h4>Payment Gateway</h4>
                                <p>All transactions processing</p>
                            </div>
                            <div class="order-status completed">Active</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Modal -->
    <div class="modal" id="action-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Action</h3>
                <button class="close-modal" id="close-action-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <p>Action content will be displayed here.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script>
        let products = [];
        let orders = [];

        async function loadDashboardData() {
            try {
                const response = await fetch('data/products.json');
                products = await response.json();
                updateDashboardStats();
                updateLowStockProducts();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function updateDashboardStats() {
            document.getElementById('total-products').textContent = products.length;
            
            const lowStockCount = products.filter(p => p.quantity < 10).length;
            document.getElementById('low-stock').textContent = lowStockCount;

            const totalRevenue = products.reduce((sum, p) => sum + (p.price * p.quantity), 0);
            document.getElementById('total-revenue').textContent = '$' + totalRevenue.toFixed(2);

            document.getElementById('total-orders').textContent = '15';
        }

        function updateLowStockProducts() {
            const lowStockContainer = document.getElementById('low-stock-products');
            const lowStockProducts = products.filter(p => p.quantity < 20);
            
            lowStockContainer.innerHTML = '';
            
            lowStockProducts.forEach(product => {
                const stockLevel = product.quantity < 5 ? 'low' : product.quantity < 15 ? 'medium' : 'good';
                const stockText = product.quantity < 5 ? `${product.quantity} left` : product.quantity < 15 ? `${product.quantity} left` : `${product.quantity} left`;
                
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.innerHTML = `
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <p>Category: ${product.category}</p>
                    </div>
                    <div class="stock-level ${stockLevel}">${stockText}</div>
                `;
                lowStockContainer.appendChild(productItem);
            });
        }

        function exportToCSV() {
            const headers = ['ID', 'Name', 'Category', 'Price', 'Original Price', 'Quantity', 'Discount (%)', 'Supplier', 'Origin Country', 'Spice Level', 'Image URL', 'Description'];
            
            const csvRows = [];
            csvRows.push(headers.join(','));
            
            products.forEach(product => {
                const row = [
                    product.id,
                    `"${product.name.replace(/"/g, '""')}"`,
                    `"${product.category}"`,
                    product.price.toFixed(2),
                    product.original_price.toFixed(2),
                    product.quantity,
                    product.discount,
                    `"${product.supplier.replace(/"/g, '""')}"`,
                    `"${product.origin_country.replace(/"/g, '""')}"`,
                    `"${product.spice_level}"`,
                    `"${product.image_url}"`,
                    `"${product.description.replace(/"/g, '""').replace(/\n/g, ' ')}"`
                ];
                csvRows.push(row.join(','));
            });
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `products_export_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
        }

        document.getElementById('export-csv-btn').addEventListener('click', exportToCSV);

        const actionModal = document.getElementById('action-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const closeActionModal = document.getElementById('close-action-modal');
        const modalCancel = document.getElementById('modal-cancel');
        const modalConfirm = document.getElementById('modal-confirm');

        function showModal(title, content, onConfirm) {
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            actionModal.classList.add('active');
            
            modalConfirm.onclick = () => {
                if (onConfirm) onConfirm();
                actionModal.classList.remove('active');
            };
        }

        closeActionModal.onclick = () => {
            actionModal.classList.remove('active');
        };

        modalCancel.onclick = () => {
            actionModal.classList.remove('active');
        };

        document.getElementById('add-product-action').onclick = () => {
            showModal('Add Product', '<p>Redirecting to product management page...</p>', () => {
                window.location.href = 'admin.html';
            });
        };

        document.getElementById('manage-orders-action').onclick = () => {
            showModal('Manage Orders', '<p>Order management feature coming soon!</p><p>You can view recent orders in the dashboard.</p>', () => {});
        };

        document.getElementById('view-customers-action').onclick = () => {
            showModal('View Customers', '<p>Customer management feature coming soon!</p><p>Currently, you can view customer information in the order details.</p>', () => {});
        };

        document.getElementById('reports-action').onclick = () => {
            showModal('View Reports', '<p>Analytics and reports feature coming soon!</p><p>Key metrics are displayed in the dashboard stats.</p>', () => {});
        };

        document.getElementById('settings-action').onclick = () => {
            showModal('Settings', '<p>Store settings feature coming soon!</p><p>Configure your store preferences, payment methods, and shipping options.</p>', () => {});
        };

        document.getElementById('notifications-action').onclick = () => {
            showModal('Notifications', '<p>System Alerts:</p><ul><li>3 products are low on stock</li><li>2 orders pending processing</li><li>System backup completed successfully</li></ul>', () => {});
        };

        document.getElementById('logout-btn').onclick = () => {
            window.location.href = 'admin.html';
        };

        loadDashboardData();

        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        });

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html>